{"version":3,"file":"useWithdrawAnalytics.js","sources":["../../../src/earn/hooks/useWithdrawAnalytics.ts"],"sourcesContent":["import { useAnalytics } from '@/core/analytics/hooks/useAnalytics';\nimport { EarnEvent } from '@/core/analytics/types';\nimport { useEarnContext } from '@/earn/components/EarnProvider';\nimport type { LifecycleStatus } from '@/transaction/types';\nimport { useEffect, useMemo, useRef, useState } from 'react';\n\nexport const useWithdrawAnalytics = (withdrawnAmount: string) => {\n  const [transactionState, setTransactionState] = useState<\n    LifecycleStatus['statusName'] | null\n  >(null);\n  const successSent = useRef(false);\n  const errorSent = useRef(false);\n  const { sendAnalytics } = useAnalytics();\n\n  const { vaultAddress, vaultToken, recipientAddress, withdrawAmount } =\n    useEarnContext();\n\n  const analyticsData = useMemo(\n    () => ({\n      amount: Number(withdrawAmount) || Number(withdrawnAmount), // fall back to withdrawnAmount to avoid sending 0\n      address: recipientAddress ?? '',\n      tokenAddress: vaultToken?.address ?? '',\n      vaultAddress,\n    }),\n    [\n      withdrawAmount,\n      withdrawnAmount,\n      recipientAddress,\n      vaultToken?.address,\n      vaultAddress,\n    ],\n  );\n\n  useEffect(() => {\n    if (transactionState === 'buildingTransaction') {\n      successSent.current = false;\n      sendAnalytics(EarnEvent.EarnWithdrawInitiated, analyticsData);\n    }\n\n    if (transactionState === 'success' && !successSent.current) {\n      successSent.current = true;\n      sendAnalytics(EarnEvent.EarnWithdrawSuccess, analyticsData);\n    }\n\n    if (transactionState === 'error' && !errorSent.current) {\n      errorSent.current = true;\n      sendAnalytics(EarnEvent.EarnWithdrawFailure, analyticsData);\n    }\n  }, [transactionState, analyticsData, sendAnalytics]);\n\n  return {\n    setTransactionState,\n  };\n};\n"],"names":[],"mappings":";;;;AAMa,MAAA,uBAAuB,CAAC,oBAA4B;AAC/D,QAAM,CAAC,kBAAkB,mBAAmB,IAAI,SAE9C,IAAI;AACA,QAAA,cAAc,OAAO,KAAK;AAC1B,QAAA,YAAY,OAAO,KAAK;AACxB,QAAA,EAAE,cAAc,IAAI,aAAa;AAEvC,QAAM,EAAE,cAAc,YAAY,kBAAkB,eAAA,IAClD,eAAe;AAEjB,QAAM,gBAAgB;AAAA,IACpB,OAAO;AAAA,MACL,QAAQ,OAAO,cAAc,KAAK,OAAO,eAAe;AAAA;AAAA,MACxD,SAAS,oBAAoB;AAAA,MAC7B,eAAc,yCAAY,YAAW;AAAA,MACrC;AAAA,IAAA;AAAA,IAEF;AAAA,MACE;AAAA,MACA;AAAA,MACA;AAAA,MACA,yCAAY;AAAA,MACZ;AAAA,IAAA;AAAA,EAEJ;AAEA,YAAU,MAAM;AACd,QAAI,qBAAqB,uBAAuB;AAC9C,kBAAY,UAAU;AACR,oBAAA,UAAU,uBAAuB,aAAa;AAAA,IAAA;AAG9D,QAAI,qBAAqB,aAAa,CAAC,YAAY,SAAS;AAC1D,kBAAY,UAAU;AACR,oBAAA,UAAU,qBAAqB,aAAa;AAAA,IAAA;AAG5D,QAAI,qBAAqB,WAAW,CAAC,UAAU,SAAS;AACtD,gBAAU,UAAU;AACN,oBAAA,UAAU,qBAAqB,aAAa;AAAA,IAAA;AAAA,EAE3D,GAAA,CAAC,kBAAkB,eAAe,aAAa,CAAC;AAE5C,SAAA;AAAA,IACL;AAAA,EACF;AACF;"}