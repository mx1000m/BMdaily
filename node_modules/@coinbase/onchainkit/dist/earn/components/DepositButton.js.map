{"version":3,"file":"DepositButton.js","sources":["../../../src/earn/components/DepositButton.tsx"],"sourcesContent":["'use client';\nimport { useDepositAnalytics } from '@/earn/hooks/useDepositAnalytics';\nimport { cn } from '@/styles/theme';\nimport {\n  type LifecycleStatus,\n  Transaction,\n  TransactionButton,\n  type TransactionResponse,\n} from '@/transaction';\nimport { ConnectWallet } from '@/wallet';\nimport { useCallback, useState } from 'react';\nimport type { DepositButtonReact } from '../types';\nimport { useEarnContext } from './EarnProvider';\n\nexport function DepositButton({ className }: DepositButtonReact) {\n  const {\n    recipientAddress: address,\n    vaultToken,\n    depositCalls,\n    depositAmount,\n    setDepositAmount,\n    depositAmountError,\n    updateLifecycleStatus,\n    refetchWalletBalance,\n    isSponsored,\n  } = useEarnContext();\n  const [depositedAmount, setDepositedAmount] = useState('');\n  const { setTransactionState } = useDepositAnalytics(depositedAmount);\n\n  const handleOnStatus = useCallback(\n    (status: LifecycleStatus) => {\n      setTransactionState(status.statusName);\n\n      if (status.statusName === 'transactionPending') {\n        updateLifecycleStatus({ statusName: 'transactionPending' });\n      }\n\n      if (\n        status.statusName === 'transactionLegacyExecuted' ||\n        status.statusName === 'success' ||\n        status.statusName === 'error'\n      ) {\n        updateLifecycleStatus(status);\n      }\n    },\n    [updateLifecycleStatus, setTransactionState],\n  );\n\n  const handleOnSuccess = useCallback(\n    (res: TransactionResponse) => {\n      if (\n        res.transactionReceipts[0] &&\n        res.transactionReceipts[0].status === 'success'\n      ) {\n        // Don't overwrite to '' when the second txn comes in\n        if (depositAmount) {\n          setDepositedAmount(depositAmount);\n        }\n        setDepositAmount('');\n        refetchWalletBalance();\n      }\n    },\n    [depositAmount, setDepositAmount, refetchWalletBalance],\n  );\n\n  if (!address) {\n    return (\n      <ConnectWallet\n        className={cn('w-full', className)}\n        text=\"Connect to deposit\"\n      />\n    );\n  }\n\n  return (\n    <Transaction\n      className={className}\n      calls={depositCalls}\n      onStatus={handleOnStatus}\n      onSuccess={handleOnSuccess}\n      isSponsored={isSponsored}\n      resetAfter={3_000}\n    >\n      <TransactionButton\n        text={depositAmountError ?? 'Deposit'}\n        successOverride={{\n          text: `Deposited ${depositedAmount} ${vaultToken?.symbol}`,\n        }}\n        disabled={!!depositAmountError || !depositAmount}\n      />\n    </Transaction>\n  );\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAcgB,SAAA,cAAc,EAAE,aAAiC;AACzD,QAAA;AAAA,IACJ,kBAAkB;AAAA,IAClB;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,MACE,eAAe;AACnB,QAAM,CAAC,iBAAiB,kBAAkB,IAAI,SAAS,EAAE;AACzD,QAAM,EAAE,oBAAA,IAAwB,oBAAoB,eAAe;AAEnE,QAAM,iBAAiB;AAAA,IACrB,CAAC,WAA4B;AAC3B,0BAAoB,OAAO,UAAU;AAEjC,UAAA,OAAO,eAAe,sBAAsB;AACxB,8BAAA,EAAE,YAAY,sBAAsB;AAAA,MAAA;AAI1D,UAAA,OAAO,eAAe,+BACtB,OAAO,eAAe,aACtB,OAAO,eAAe,SACtB;AACA,8BAAsB,MAAM;AAAA,MAAA;AAAA,IAEhC;AAAA,IACA,CAAC,uBAAuB,mBAAmB;AAAA,EAC7C;AAEA,QAAM,kBAAkB;AAAA,IACtB,CAAC,QAA6B;AAE1B,UAAA,IAAI,oBAAoB,CAAC,KACzB,IAAI,oBAAoB,CAAC,EAAE,WAAW,WACtC;AAEA,YAAI,eAAe;AACjB,6BAAmB,aAAa;AAAA,QAAA;AAElC,yBAAiB,EAAE;AACE,6BAAA;AAAA,MAAA;AAAA,IAEzB;AAAA,IACA,CAAC,eAAe,kBAAkB,oBAAoB;AAAA,EACxD;AAEA,MAAI,CAAC,SAAS;AAEV,WAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,WAAW,GAAG,UAAU,SAAS;AAAA,QACjC,MAAK;AAAA,MAAA;AAAA,IACP;AAAA,EAAA;AAKF,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC;AAAA,MACA,OAAO;AAAA,MACP,UAAU;AAAA,MACV,WAAW;AAAA,MACX;AAAA,MACA,YAAY;AAAA,MAEZ,UAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,MAAM,sBAAsB;AAAA,UAC5B,iBAAiB;AAAA,YACf,MAAM,aAAa,eAAe,IAAI,yCAAY,MAAM;AAAA,UAC1D;AAAA,UACA,UAAU,CAAC,CAAC,sBAAsB,CAAC;AAAA,QAAA;AAAA,MAAA;AAAA,IACrC;AAAA,EACF;AAEJ;"}