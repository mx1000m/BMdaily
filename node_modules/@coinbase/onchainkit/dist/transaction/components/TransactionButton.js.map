{"version":3,"file":"TransactionButton.js","sources":["../../../src/transaction/components/TransactionButton.tsx"],"sourcesContent":["import { useCallback, useMemo } from 'react';\nimport { useAccount, useChainId } from 'wagmi';\nimport { getChainExplorer } from '../../core/network/getChainExplorer';\nimport { Spinner } from '../../internal/components/Spinner';\nimport { border, cn, color, pressable, text } from '../../styles/theme';\nimport type { TransactionButtonReact } from '../types';\nimport { isSpinnerDisplayed } from '../utils/isSpinnerDisplayed';\nimport { useTransactionContext } from './TransactionProvider';\n\nexport function TransactionButton({\n  className,\n  disabled = false,\n  text: idleText = 'Transact',\n  errorOverride,\n  successOverride,\n  pendingOverride,\n}: TransactionButtonReact) {\n  const {\n    chainId,\n    errorMessage,\n    isLoading,\n    lifecycleStatus,\n    onSubmit,\n    receipt,\n    transactions,\n    transactionCount,\n    transactionHash,\n    transactionId,\n  } = useTransactionContext();\n\n  const { address } = useAccount();\n  // eslint-disable-next-line react-hooks/rules-of-hooks\n  const accountChainId = chainId ?? useChainId();\n\n  const isLegacyTransactionInProgress =\n    lifecycleStatus.statusName === 'transactionLegacyExecuted' &&\n    transactionCount !==\n      lifecycleStatus?.statusData?.transactionHashList?.length;\n\n  const isInProgress =\n    lifecycleStatus.statusName === 'buildingTransaction' ||\n    lifecycleStatus.statusName === 'transactionPending' ||\n    isLegacyTransactionInProgress ||\n    isLoading;\n\n  const isMissingProps = !transactions || !address;\n  const isWaitingForReceipt = !!transactionId || !!transactionHash;\n\n  const isDisabled =\n    !receipt &&\n    (isInProgress || isMissingProps || isWaitingForReceipt || disabled);\n\n  const displayPendingState = isSpinnerDisplayed({\n    errorMessage,\n    hasReceipt: !!receipt,\n    isInProgress,\n    transactionHash,\n    transactionId,\n  });\n\n  const { errorText, successText, pendingContent } = useMemo(() => {\n    const successText = successOverride?.text ?? 'View transaction';\n    const errorText = errorOverride?.text ?? 'Try again';\n    const pendingContent = pendingOverride?.text ?? <Spinner />;\n\n    return { successText, errorText, pendingContent };\n  }, [errorOverride, pendingOverride, successOverride]);\n\n  const defaultSuccessHandler = useCallback(() => {\n    // SW will have txn id so open in wallet\n    if (receipt && transactionId && transactionHash && chainId && address) {\n      const url = new URL('https://wallet.coinbase.com/assets/transactions');\n      url.searchParams.set('contentParams[txHash]', transactionHash);\n      url.searchParams.set('contentParams[chainId]', JSON.stringify(chainId));\n      url.searchParams.set('contentParams[fromAddress]', address);\n      return window.open(url, '_blank', 'noopener,noreferrer');\n    }\n    // EOA will not have txn id so open in explorer\n    const chainExplorer = getChainExplorer(accountChainId);\n    return window.open(\n      `${chainExplorer}/tx/${transactionHash}`,\n      '_blank',\n      'noopener,noreferrer',\n    );\n  }, [\n    address,\n    chainId,\n    receipt,\n    transactionId,\n    transactionHash,\n    accountChainId,\n  ]);\n\n  const successHandler = useCallback(() => {\n    if (successOverride?.onClick && receipt) {\n      return successOverride?.onClick?.(receipt);\n    }\n    defaultSuccessHandler();\n  }, [defaultSuccessHandler, successOverride, receipt]);\n\n  const errorHandler = useCallback(() => {\n    if (errorOverride?.onClick) {\n      return errorOverride?.onClick?.();\n    }\n    // if no custom logic, retry submit\n    return onSubmit();\n  }, [errorOverride, onSubmit]);\n\n  const buttonContent = useMemo(() => {\n    // txn successful\n    if (receipt) {\n      return successText;\n    }\n    if (errorMessage) {\n      return errorText;\n    }\n    if (displayPendingState) {\n      return pendingContent;\n    }\n    return idleText;\n  }, [\n    displayPendingState,\n    errorMessage,\n    errorText,\n    idleText,\n    pendingContent,\n    receipt,\n    successText,\n  ]);\n\n  const handleSubmit = useCallback(() => {\n    if (receipt) {\n      successHandler();\n    } else if (errorMessage) {\n      errorHandler();\n    } else {\n      onSubmit();\n    }\n  }, [errorMessage, errorHandler, onSubmit, receipt, successHandler]);\n\n  return (\n    <button\n      className={cn(\n        pressable.primary,\n        border.radius,\n        'w-full rounded-xl',\n        'px-4 py-3 font-medium leading-6',\n        isDisabled && pressable.disabled,\n        text.headline,\n        color.inverse,\n        className,\n      )}\n      onClick={handleSubmit}\n      type=\"button\"\n      disabled={isDisabled}\n      data-testid=\"ockTransactionButton_Button\"\n    >\n      {buttonContent}\n    </button>\n  );\n}\n"],"names":["successText","errorText","pendingContent","_a"],"mappings":"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"}